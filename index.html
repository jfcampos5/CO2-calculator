<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Calc CO₂</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  
  <!-- Leaflet (mapa) --> 
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  
  <!-- Estilo personalizado -->
  <link rel="stylesheet" href="style.css">

  <!-- Bibliotecas externas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
  <noscript>Para usar a Calculadora de CO<sub>2</sub> você precisa habilitar JavaScript.</noscript>

  <!-- ===== HEADER ===== -->
  <header class="app-header" role="banner">
    <div class="container header-content">
      <div class="brand">
        <img src="assets/img/logo.png" alt="" width="90" height="90" aria-hidden="true" />        
        <div>
          <h1 class="app-title">Calculadora de Emissão de CO₂</h1>
          <p class="app-subtitle">Calcule as emissões da sua viagem e adote escolhas mais sustentáveis para o futuro do planeta.</p>
        </div>
      </div>
      <div class="header-actions">
      <button id="theme-toggle" class="btn btn-ghost" type="button" aria-label="Alternar tema">
        <span aria-hidden="true">
          <!-- Ícone pode mudar conforme o tema -->
          <img id="theme-icon" src="assets/img/emojitema.png" alt="Alternar entre tema claro e escuro" width="35" height="35">
        </span>
      </button>
    </div>
   </div>
  </header>

  <!-- ===== MAIN ===== -->
  <main id="conteudo-principal" class="app-main container" role="main">
    <div class="layout">
      <!-- ===== ASIDE (Wizard) ===== -->
      <aside class="sidebar" aria-label="Assistente de cálculo">
        <form id="trip-form" novalidate>

          <!-- === PASSO 1 === -->
          <section class="card card-hero" data-step="1" aria-labelledby="step1-title">
            <div class="card-header-gradient"></div>
            <h2 id="step1-title" class="card-title">Informe sua rota</h2>

            <div class="form-group">
            <label for="estado-origem">Estado de Origem</label>
            <select id="estado-origem" name="estadoOrigem" required>
              <option value="">Selecione</option>
              <option value="AC">Acre</option>
              <option value="AL">Alagoas</option>
              <option value="AP">Amapá</option>
              <option value="AM">Amazonas</option>
              <option value="BA">Bahia</option>
              <option value="CE">Ceará</option>
              <option value="DF">Distrito Federal</option>
              <option value="ES">Espírito Santo</option>
              <option value="GO">Goiás</option>
              <option value="MA">Maranhão</option>
              <option value="MT">Mato Grosso</option>
              <option value="MS">Mato Grosso do Sul</option>
              <option value="MG">Minas Gerais</option>
              <option value="PA">Pará</option>
              <option value="PB">Paraíba</option>
              <option value="PR">Paraná</option>
              <option value="PE">Pernambuco</option>
              <option value="PI">Piauí</option>
              <option value="RJ">Rio de Janeiro</option>
              <option value="RN">Rio Grande do Norte</option>
              <option value="RS">Rio Grande do Sul</option>
              <option value="RO">Rondônia</option>
              <option value="RR">Roraima</option>
              <option value="SC">Santa Catarina</option>
              <option value="SP">São Paulo</option>
              <option value="SE">Sergipe</option>
              <option value="TO">Tocantins</option>
            </select>

            <label for="cidade-origem">Cidade de Origem</label>
            <input id="cidade-origem" name="cidadeOrigem" type="text" placeholder="Digite a cidade de origem" required />
          </div>

          <div class="form-group">
            <label for="estado-destino">Estado de Destino</label>
            <select id="estado-destino" name="estadoDestino" required>
              <option value="">Selecione</option>
              <option value="AC">Acre</option>
              <option value="AL">Alagoas</option>
              <option value="AP">Amapá</option>
              <option value="AM">Amazonas</option>
              <option value="BA">Bahia</option>
              <option value="CE">Ceará</option>
              <option value="DF">Distrito Federal</option>
              <option value="ES">Espírito Santo</option>
              <option value="GO">Goiás</option>
              <option value="MA">Maranhão</option>
              <option value="MT">Mato Grosso</option>
              <option value="MS">Mato Grosso do Sul</option>
              <option value="MG">Minas Gerais</option>
              <option value="PA">Pará</option>
              <option value="PB">Paraíba</option>
              <option value="PR">Paraná</option>
              <option value="PE">Pernambuco</option>
              <option value="PI">Piauí</option>
              <option value="RJ">Rio de Janeiro</option>
              <option value="RN">Rio Grande do Norte</option>
              <option value="RS">Rio Grande do Sul</option>
              <option value="RO">Rondônia</option>
              <option value="RR">Roraima</option>
              <option value="SC">Santa Catarina</option>
              <option value="SP">São Paulo</option>
              <option value="SE">Sergipe</option>
              <option value="TO">Tocantins</option>
            </select>

            <label for="cidade-destino">Cidade de Destino</label>
            <input id="cidade-destino" name="cidadeDestino" type="text" placeholder="Digite a cidade de destino" required />
          </div>

          <div class="form-group">
            <label class="checkbox">
              <input type="checkbox" id="manual-distance" name="manualDistance"/>
              <span>Inserir distância manualmente</span>
            </label>
          </div>

            <div class="form-group is-disabled" id="distance-wrapper">
              <label for="distance-km">Distância (km)</label>
              <input id="distance-km" name="distanceKm" type="number" inputmode="decimal" step="0.1" min="0" placeholder="0" aria-describedby="distance-help"/>
              <small id="distance-help" class="help">Se não informado, calcularemos pelo mapa.</small>
            </div>

            <!-- Modal com ícones -->
          <fieldset class="form-group" aria-labelledby="transport-legend">
            <legend id="transport-legend">Meio de Transporte</legend>
            <div class="modal-icons">
              <label class="modal-option" data-modal="bicicleta">
                <input type="radio" id="bicicleta" name="modal" value="bicicleta" />
                <span class="icon">
                  <img src="assets/img/bicicleta.png" alt="Bicicleta" aria-hidden="true" width="35" height="45"/>
                </span>
                <span class="text">Bicicleta</span>
              </label>

              <label class="modal-option" data-modal="carro">
                <input type="radio" id="carro" name="modal" value="carro" checked/>
                <span class="icon">
                  <img src="assets/img/carro.png" alt="Carro" aria-hidden="true" width="45" height="45"/>
                </span>
                <span class="text">Carro</span>
              </label>

              <label class="modal-option" data-modal="onibus">
                <input type="radio" id="onibus" name="modal" value="onibus" />
                <span class="icon">
                  <img src="assets/img/onibus.png" alt="Ônibus" aria-hidden="true" width="42" height="45"/>
                </span>
                <span class="text">Ônibus</span>
              </label>

              <label class="modal-option" data-modal="caminhao">
                <input type="radio" id="caminhao" name="modal" value="caminhao" />
                <span class="icon-wrapper">
                  <img src="assets/img/caminhao.png" alt="Caminhão" aria-hidden="true" width="45" height="45"/>
                </span>
                <span class="text">Caminhão</span>
              </label>

              <label class="modal-option" data-modal="moto">
                <input type="radio" id="moto" name="modal" value="moto" />
                <span class="icon">
                  <img src="assets/img/moto.png" alt="Moto" aria-hidden="true" width="45" height="45"/>
                </span>
                <span class="text">Moto</span>
              </label>
            </div>
          </fieldset>

          <fieldset class="form-group" aria-labelledby="fuel-legend">
              <legend id="fuel-legend">Combustível</legend>
                <div class="fuel-options">
                  <label>
                    <input type="radio" id="gasolina" name="combustivel" value="gasolina" />
                    Gasolina
                  </label>

                  <label>
                    <input type="radio" id="etanol" name="combustivel" value="etanol" />
                    Etanol
                  </label>

                  <label>
                    <input type="radio" id="diesel" name="combustivel" value="diesel" />
                    Diesel
                  </label>

                  <label>
                    <input type="radio" id="nenhum" name="combustivel" value="nenhum" />
                    Nenhum
                  </label>
                </div>
              </fieldset>

          <div class="form-inline">
            <button type="submit" id="btn-calc-step1" class="btn btn-primary">Calcular</button>
            <button type="button" id="btn-clear-step1" class="btn btn-ghost">Limpar</button>
          </div>

          <div id="form-errors" class="form-errors" role="alert" aria-live="assertive"></div>

          <!-- === PASSO 2 === -->
        <section class="card is-hidden" data-step="2" aria-labelledby="step2-title">
          <h2 id="step2-title" class="card-title">Combustível &amp; Eficiência</h2>

          <div class="form-group" id="combustivel-wrapper" style="display:none;">
            <label for="combustivel">Combustível</label>
            <select id="combustivel" name="combustivel" aria-describedby="fuel-help">
              <option value="selecione">Selecione</option>
              <option value="gasolina">Gasolina</option>
              <option value="etanol">Etanol</option>
              <option value="flex">Flex (gasolina + etanol)</option>
              <option value="diesel">Diesel</option>
              <option value="nenhum">Nenhum (bicicleta)</option>
            </select>
            <small id="fuel-help" class="help">Necessário apenas para carro e moto.</small>            
          </div>

          <div id="flex-mix-wrapper" class="form-group is-hidden" data-show-when="fuel:flex">
            <label for="flex-mix">Mistura Flex — Gasolina (%)</label>
            <input id="flex-mix" name="flexGasolinaPct" type="range" min="0" max="100" step="1" value="50" />
            <div class="range-output" aria-live="polite">
              <output id="flex-gasolina-out">50%</output> gasolina — <output id="flex-etanol-out">50%</output> etanol
            </div>
          </div>

          <div class="form-group">
            <label for="efficiency-km-l">Consumo do veículo (km/L)</label>
            <input id="efficiency-km-l" name="efficiencyKmPerL" type="number" inputmode="decimal" step="0.1" min="0" placeholder="Ex.: 12" aria-describedby="efficiency-help" />
            <small id="efficiency-help" class="help">Se não souber, usaremos médias por modal/combustível.</small>
          </div>

          <div class="form-group">
            <label for="trip-profile">Perfil da viagem</label>
            <select id="trip-profile" name="tripProfile">
              <option value="misto" selected>Misto (padrão)</option>
              <option value="urbano">Urbano</option>
              <option value="rodoviario">Rodoviário</option>
            </select>
          </div>

          <div id="bus-passenger-wrapper" class="form-group is-hidden" data-show-when="modal:onibus">
            <label for="bus-occupancy">Ocupação (passageiros)</label>
            <input id="bus-occupancy" name="busOccupancy" type="number" inputmode="numeric" step="1" min="1" value="40" />
            <label class="checkbox">
              <input type="checkbox" id="calc-per-passenger" name="calcPerPassenger" checked />
              <span>Calcular emissões por passageiro</span>
            </label>
          </div>

          <div id="truck-payload-wrapper" class="form-group is-hidden" data-show-when="modal:caminhao">
            <label for="payload-kg">Carga transportada (kg) <span class="muted">(opcional)</span></label>
            <small id="payload-help" class="help">Informe a carga em kg, se desejar detalhar.</small>
            <input id="payload-kg" name="payloadKg" type="number" inputmode="numeric" step="10" min="0" placeholder="Ex.: 8000" aria-describedby="payload-help" />
          </div>

          <div class="form-group">
            <label class="switch">
              <input type="checkbox" id="toggle-wtw" name="useWTW" />
              <span class="slider" aria-hidden="true"></span>
              <span class="switch-label">Usar cadeia completa (WTW) em vez de apenas queima (TTW)</span>
            </label>
          </div>

          <div class="form-inline">
            <button type="button" id="btn-recalc" class="btn btn-primary">Recalcular</button>
            <button type="button" id="btn-next-to-results" class="btn btn-secondary">Ver resultados</button>
          </div>
        </section>
        </form>
        </aside>

      <!-- ===== CONTENT (oculto até calcular) ===== -->
      <section class="content">       

      <!-- MAPA -->
      <section class="card is-hidden" data-panel="map" aria-labelledby="map-title">
        <h2 id="map-title" class="card-title">Mapa da Rota</h2>
        <div id="map" class="map-container" role="application" aria-label="Mapa interativo do Brasil" tabindex="0"></div>
        <div class="map-legend">
          <span class="badge">Origem</span>
          <span class="badge badge-alt">Destino</span>
          <span class="badge badge-info">Trajeto</span>
        </div>
      </section>

      <!-- RESULTADOS -->
      <section class="card is-hidden" data-panel="results" aria-labelledby="results-title">
        <h2 id="results-title" class="card-title">Resultados</h2>
        <div class="results-grid" aria-live="polite">
          <div class="result-item">
            <div class="result-label">Distância total</div>
            <div class="result-value">
              <span id="out-distance-km" aria-describedby="distance-label">—</span> 
              <span class="unit">km</span>
            </div>
            <small id="distance-label" class="help">Distância percorrida em quilômetros</small>
          </div>

          <div class="result-item">
            <div class="result-label">Combustível estimado</div>
            <div class="result-value">
              <span id="out-liters" aria-describedby="fuel-label">—</span> 
              <span class="unit">L</span>
            </div>
            <small id="fuel-label" class="help">Litros de combustível consumidos</small>
            <div class="result-sub" id="out-fuel-summary">—</div>
          </div>

          <div class="result-item">
            <div class="result-label">Emissão total</div>
            <div class="result-value">
              <span id="out-total-kg" aria-describedby="emission-label">—</span> 
              <span class="unit">kg CO₂</span>
            </div>
            <small id="emission-label" class="help">Quantidade total de emissões de CO₂</small>
            <div class="result-sub"><span id="out-per-km">—</span> g CO₂/km</div>
          </div>

          <div class="result-item">
            <div class="result-label">Equivalência</div>
            <div class="result-sub" id="out-equivalences">—</div>
          </div>
        </div>

        <div class="chart-wrapper">
          <canvas id="emissions-chart" width="600" height="300" aria-label="Gráfico de emissões" role="img"></canvas>
        </div>

        <div class="meta">
          <span id="precision-badge" class="badge">Precisão: média (sem consumo informado)</span>
          <span id="basis-badge" class="badge badge-alt">Base: TTW</span>
        </div>

        <div class="form-inline">
          <button type="button" id="btn-save-trip" class="btn btn-secondary">Salvar viagem</button>
          <button type="button" id="btn-export-pdf" class="btn btn-secondary">Exportar PDF</button>
        </div>
      </section>

      <!-- HISTÓRICO -->
      <section class="card is-hidden" data-panel="history" aria-labelledby="history-title">
        <h2 id="history-title" class="card-title">Histórico de viagens</h2>
        <ul id="history-list" class="history-list" role="list" aria-live="polite">
        <!-- Cada viagem renderizada como <li role="listitem"> -->
        </ul>
        <div class="form-inline">
          <button type="button" id="btn-clear-history" class="btn btn-ghost">Limpar histórico</button>
        </div>
      </section>
      </section>
    </div>
  </main>

  <section class="card" data-panel="map" aria-labelledby="map-title">
    <h2 id="map-title" class="card-title">Mapa da Rota</h2> 
    <div id="map" class="map-container"></div> 
  </section>

    <!-- ===== FOOTER ===== -->
  <footer class="app-footer" role="contentinfo">
    <div class="container">
      <p class="muted" id="disclaimer" aria-label="Aviso importante">
        ⚠️ Estimativas sujeitas a variações de veículo, rota e condições.
      </p>
      <p class="muted">
        © <span id="year"></span> Calc CO₂ - Criado por Joelma Campos | Todos os direitos reservados
      </p>
    </div>
  </footer>

  <!-- Scripts --> 
   <script src="ui.js"></script> 
   <script src="map.js"></script> 

  <!-- Toasts -->
  <div id="toast-container" class="toast-container" aria-live="assertive" aria-atomic="true" role="status">
    <!-- Cada toast será renderizado como:
    <div class="toast" role="alert">Mensagem aqui</div>
    -->
  </div>

  <!-- ====== SCRIPTS (ES Modules) ====== -->
  <script type="module" src="assets/js/config.js"></script>
  <script type="module" src="assets/js/co2-factors.js"></script>
  <script type="module" src="assets/js/utils.js"></script>
  <script type="module" src="assets/js/map-api.js"></script>
  <script type="module" src="assets/js/ui.js"></script>
  <script type="module" src="assets/js/app.js"></script>

  </body>
  </html>
