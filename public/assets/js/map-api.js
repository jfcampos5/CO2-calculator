let map=null; let routeLayer=null;
export async function initMap(){ if(typeof L==='undefined'){ await new Promise(r=>setTimeout(r,200)); } if(typeof L==='undefined') return null; if(!map){ map=L.map("map",{center:[-15.79,-47.88],zoom:4}); L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map); } return map; }
export async function getRouteDistance(origin,dest){ const res = await fetch("/api/route",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({origin,dest})}); if(!res.ok) return null; const j=await res.json(); if(!map) await initMap(); if(map && j.geometry){ if(routeLayer) map.removeLayer(routeLayer); routeLayer=L.geoJSON(j.geometry,{style:()=>({color:'#16a34a',weight:4})}).addTo(map); map.fitBounds(routeLayer.getBounds(),{padding:[40,40]}); } return j.distanceKm; }
