<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Calc CO‚ÇÇ</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  
  <!-- Estilo personalizado -->
  <link rel="stylesheet" href="assets/css/style.css">

  <!-- Bibliotecas externas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
  <noscript>Para usar a Calculadora de CO<sub>2</sub> voc√™ precisa habilitar JavaScript.</noscript>

  <!-- Skip link (A11y) -->
  <a class="skip-link" href="#conteudo-principal">Pular para o conte√∫do</a>

  <!-- ===== HEADER ===== -->
  <header class="app-header" role="banner">
    <div class="container header-content">
      <div class="brand">
        <img src="/assets/img/logo.png" alt="" width="32" height="32" aria-hidden="true" />
        <div>
          <h1 class="app-title">Calculadora de Emiss√£o de CO‚ÇÇ</h1>
          <p class="app-subtitle">Calcule as emiss√µes da sua viagem e ajude um planeta mais sustent√°vel.</p>
        </div>
      </div>
      <div class="header-actions">
        <button id="theme-toggle" class="btn btn-ghost" type="button" aria-label="Alternar tema">
          <span aria-hidden="true">üåì</span>
        </button>
      </div>
    </div>
  </header>

  <!-- ===== MAIN ===== -->
  <main id="conteudo-principal" class="app-main container" role="main">
    <div class="layout">
      <!-- ===== ASIDE (Wizard) ===== -->
      <aside class="sidebar" aria-label="Assistente de c√°lculo">
        <form id="trip-form" novalidate>

          <!-- === PASSO 1 === -->
          <section class="card card-hero" data-step="1" aria-labelledby="step1-title">
            <div class="card-header-gradient"></div>
            <h2 id="step1-title" class="card-title">Informe sua rota</h2>

            <div class="form-group">
              <label for="origin-city">Origem</label>
              <input id="origin-city" name="originCity" type="text" placeholder="Digite a cidade de origem" autocomplete="address-level2" required />
            </div>

            <div class="form-group">
              <label for="dest-city">Destino</label>
              <input id="dest-city" name="destCity" type="text" placeholder="Digite a cidade de destino" autocomplete="address-level2" required />
            </div>

            <div class="form-group">
              <label class="checkbox">
                <input type="checkbox" id="manual-distance" name="manualDistance" />
                <span>Inserir dist√¢ncia manualmente</span>
              </label>
            </div>

            <div class="form-group is-disabled" id="distance-wrapper">
              <label for="distance-km">Dist√¢ncia (km)</label>
              <input id="distance-km" name="distanceKm" type="number" inputmode="decimal" step="0.1" min="0" placeholder="0" aria-describedby="distance-help" disabled />
              <small id="distance-help" class="help">Se n√£o informado, calcularemos pelo mapa.</small>
            </div>

            <!-- Modal com √≠cones -->
            <fieldset class="form-group" aria-labelledby="transport-legend">
              <legend id="transport-legend">Meio de Transporte</legend>
              <div class="modal-icons">
                <label class="modal-option" data-modal="bicicleta">
                  <input type="radio" name="modal" value="bicicleta" />
                  <span class="icon"><img src="assets/img/biscleta.png" alt="biblioteca" aria-hidden="true" width="35" height="45"/></span>
                  <span class="text">Bicicleta</span>
                </label>
                <label class="modal-option is-active" data-modal="carro">
                  <input type="radio" name="modal" value="carro" checked />
                  <span class="icon"><img src="assets/img/carro.png" alt="carro" aria-hidden="true" width="45" height="45"/></span>
                  <span class="text">Carro</span>
                </label>
                <label class="modal-option" data-modal="onibus">
                  <input type="radio" name="modal" value="onibus" />
                  <span class="icon"><img src="assets/img/onibus.png" alt="onibus" aria-hidden="true" width="42" height="45"  /></span>
                  <span class="text">√înibus</span>
                </label>
                <label class="modal-option" data-modal="caminhao">
                  <input type="radio" name="modal" value="caminhao" />
                  <span class="icon-wrapper"><img src="assets/img/caminhao.png" alt="Caminh√£o" aria-hidden="true" width="45" height="45"/></span>
                  <span class="text">Caminh√£o</span>
                </label>
                
                <label class="modal-option" data-modal="moto">
                  <input type="radio" name="modal" value="moto" />
                  <span class="icon"><img src="assets/img/moto.png" alt="moto" aria-hidden="true" alt="Moto" width="45" height="45"/></span>
                  <span class="text">Moto</span>
                </label>
              </div>            
            </fieldset>

            <div class="form-inline">
              <button type="submit" id="btn-calc-step1" class="btn btn-primary">Calcular</button>
              <button type="button" id="btn-clear-step1" class="btn btn-ghost">Limpar</button>
            </div>

            <div id="form-errors" class="form-errors" role="alert" aria-live="assertive"></div>
          </section>

          <!-- === PASSO 2 === -->
          <section class="card is-hidden" data-step="2" aria-labelledby="step2-title">
            <h2 id="step2-title" class="card-title">Combust√≠vel &amp; Efici√™ncia</h2>

            <div class="form-group">
              <label for="fuel-type">Combust√≠vel</label>
              <select id="fuel-type" name="fuelType" aria-describedby="fuel-help">
                <option value="gasolina">Gasolina</option>
                <option value="etanol">Etanol</option>
                <option value="flex">Flex (gasolina + etanol)</option>
                <option value="diesel">Diesel</option>
                <option value="nenhum">Nenhum (bicicleta)</option>
              </select>
              <small id="fuel-help" class="help">As op√ß√µes se adaptam ao modal.</small>
            </div>

            <div id="flex-mix-wrapper" class="form-group is-hidden" data-show-when="fuel:flex">
              <label for="flex-mix">Mistura Flex ‚Äî Gasolina (%)</label>
              <input id="flex-mix" name="flexGasolinaPct" type="range" min="0" max="100" step="1" value="50" />
              <div class="range-output" aria-live="polite">
                <output id="flex-gasolina-out">50%</output> gasolina ‚Äî <output id="flex-etanol-out">50%</output> etanol
              </div>
            </div>

            <div class="form-group">
              <label for="efficiency-km-l">Consumo do ve√≠culo (km/L)</label>
              <input id="efficiency-km-l" name="efficiencyKmPerL" type="number" inputmode="decimal" step="0.1" min="0" placeholder="Ex.: 12" aria-describedby="efficiency-help" />
              <small id="efficiency-help" class="help">Se n√£o souber, usaremos m√©dias por modal/combust√≠vel.</small>
            </div>

            <div class="form-group">
              <label for="trip-profile">Perfil da viagem</label>
              <select id="trip-profile" name="tripProfile">
                <option value="misto" selected>Misto (padr√£o)</option>
                <option value="urbano">Urbano</option>
                <option value="rodoviario">Rodovi√°rio</option>
              </select>
            </div>

            <div id="bus-passenger-wrapper" class="form-group is-hidden" data-show-when="modal:onibus">
              <label for="bus-occupancy">Ocupa√ß√£o (passageiros)</label>
              <input id="bus-occupancy" name="busOccupancy" type="number" inputmode="numeric" step="1" min="1" value="40" />
              <label class="checkbox">
                <input type="checkbox" id="calc-per-passenger" name="calcPerPassenger" checked />
                <span>Calcular emiss√µes por passageiro</span>
              </label>
            </div>

            <div id="truck-payload-wrapper" class="form-group is-hidden" data-show-when="modal:caminhao">
              <label for="payload-kg">Carga transportada (kg) <span class="muted">(opcional)</span></label>
              <input id="payload-kg" name="payloadKg" type="number" inputmode="numeric" step="10" min="0" placeholder="Ex.: 8000" />
            </div>

            <div class="form-group">
              <label class="switch">
                <input type="checkbox" id="toggle-wtw" name="useWTW" />
                <span class="slider" aria-hidden="true"></span>
                <span class="switch-label">Usar cadeia completa (WTW) em vez de apenas queima (TTW)</span>
              </label>
            </div>

            <div class="form-inline">
              <button type="button" id="btn-recalc" class="btn btn-primary">Recalcular</button>
              <button type="button" id="btn-next-to-results" class="btn btn-secondary">Ver resultados</button>
            </div>
          </section>
        </form>
      </aside>

      <!-- ===== CONTENT (oculto at√© calcular) ===== -->
      <section class="content">

        <!-- MAPA -->
        <section class="card is-hidden" data-panel="map" aria-labelledby="map-title">
          <h2 id="map-title" class="card-title">Mapa da Rota</h2>
          <div id="map" class="map-container" role="application" aria-label="Mapa interativo do Brasil"></div>
          <div class="map-legend" aria-hidden="true">
            <span class="badge">Origem</span>
            <span class="badge badge-alt">Destino</span>
            <span class="badge badge-info">Trajeto</span>
          </div>
        </section>

        <!-- RESULTADOS -->
        <section class="card is-hidden" data-panel="results" aria-labelledby="results-title">
          <h2 id="results-title" class="card-title">Resultados</h2>

          <div class="results-grid" aria-live="polite">
            <div class="result-item">
              <div class="result-label">Dist√¢ncia total</div>
              <div class="result-value"><span id="out-distance-km">‚Äî</span> <span class="unit">km</span></div>
            </div>

            <div class="result-item">
              <div class="result-label">Combust√≠vel estimado</div>
              <div class="result-value"><span id="out-liters">‚Äî</span> <span class="unit">L</span></div>
              <div class="result-sub" id="out-fuel-summary">‚Äî</div>
            </div>

            <div class="result-item">
              <div class="result-label">Emiss√£o total</div>
              <div class="result-value"><span id="out-total-kg">‚Äî</span> <span class="unit">kg CO‚ÇÇ</span></div>
              <div class="result-sub"><span id="out-per-km">‚Äî</span> g CO‚ÇÇ/km</div>
            </div>

            <div class="result-item">
              <div class="result-label">Equival√™ncia</div>
              <div class="result-sub" id="out-equivalences">‚Äî</div>
            </div>
          </div>

          <div class="chart-wrapper">
            <canvas id="emissions-chart" width="600" height="300" aria-label="Gr√°fico de emiss√µes" role="img"></canvas>
          </div>

          <div class="meta">
            <span id="precision-badge" class="badge">Precis√£o: m√©dia (sem consumo informado)</span>
            <span id="basis-badge" class="badge badge-alt">Base: TTW</span>
          </div>

          <div class="form-inline">
            <button type="button" id="btn-save-trip" class="btn btn-secondary">Salvar viagem</button>
            <button type="button" id="btn-export-pdf" class="btn btn-secondary">Exportar PDF</button>
          </div>
        </section>

        <!-- HIST√ìRICO -->
        <section class="card is-hidden" data-panel="history" aria-labelledby="history-title">
          <h2 id="history-title" class="card-title">Hist√≥rico de viagens</h2>
          <div id="history-list" class="history-list" role="list"></div>
          <div class="form-inline">
            <button type="button" id="btn-clear-history" class="btn btn-ghost">Limpar hist√≥rico</button>
          </div>
        </section>
      </section>
    </div>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="app-footer" role="contentinfo">
    <div class="container">
      <p class="muted">‚ö†Ô∏è Estimativas sujeitas a varia√ß√µes de ve√≠culo, rota e condi√ß√µes.</p>
      <p class="muted">¬© <span id="year"></span> Calc CO‚ÇÇ ‚Äî Feito com ‚ôªÔ∏è no Brasil.</p>
    </div>
  </footer>


 <!-- Toasts -->
  <div id="toast-container" class="toast-container" aria-live="assertive" aria-atomic="true"></div>

<!-- ====== SCRIPTS (ES Modules) ====== -->
   <script type="module" src="assets/js/config.js"></script>
    <script type="module" src="assets/js/co2-factors.js"></script>
    <script type="module" src="assets/js/utils.js"></script>
    <script type="module" src="assets/js/map-api.js"></script>
    <script type="module" src="assets/js/ui.js"></script>
    <script type="module" src="assets/js/app.js"></script>


</body>
</html>
